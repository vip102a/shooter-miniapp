<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Survival Shooter ‚Äì Sound Test</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * { box-sizing:border-box; }
    body {
      margin:0;
      padding:16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #202642 0%, #050712 55%, #020308 100%);
      color:#fff;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    h1 {
      margin-top:8px;
      margin-bottom:4px;
      font-size:22px;
    }
    p {
      margin:0 0 12px;
      font-size:13px;
      opacity:0.9;
      text-align:center;
    }
    .panel {
      width:100%;
      max-width:420px;
      background:rgba(0,0,0,0.5);
      border-radius:16px;
      padding:12px;
      margin-top:10px;
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
    }
    .panel-title {
      font-size:14px;
      font-weight:600;
      margin-bottom:8px;
      opacity:0.9;
    }
    .btn-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:8px;
    }
    button {
      border:none;
      border-radius:999px;
      padding:8px 12px;
      font-size:13px;
      cursor:pointer;
      background:#ffb100;
      color:#201317;
      font-weight:600;
      box-shadow:0 6px 16px rgba(0,0,0,0.5);
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    button.secondary {
      background:rgba(255,255,255,0.08);
      color:#fff;
      box-shadow:none;
    }
    button:active {
      transform:scale(0.96);
    }
    small {
      font-size:11px;
      opacity:0.75;
    }
    .footer {
      margin-top:18px;
      font-size:11px;
      opacity:0.7;
      text-align:center;
      max-width:420px;
    }
    .volume-row {
      display:flex;
      align-items:center;
      gap:8px;
      margin-top:4px;
    }
    input[type="range"] {
      flex:1;
    }
  </style>
</head>
<body>
  <h1>üîä Survival Shooter ‚Äì Sound Test</h1>
  <p>
    Nh·∫•n t·ª´ng n√∫t ƒë·ªÉ nghe th·ª≠ √¢m thanh s·∫Ω d√πng trong game.<br/>
    T·∫•t c·∫£ ƒë·ªÅu l√† √¢m t·ªïng h·ª£p b·∫±ng Web Audio (kh√¥ng d√πng file gi·ªçng th·∫≠t, kh√¥ng b·∫£n quy·ªÅn).
  </p>

  <div class="panel">
    <div class="panel-title">‚öôÔ∏è Audio Control</div>
    <div class="btn-row">
      <button id="btnInitAudio">B·∫≠t Audio (unmute)</button>
      <button id="btnStopAudio" class="secondary">Ng·∫Øt m·ªçi √¢m</button>
    </div>
    <div class="volume-row">
      <span>üîâ Volume</span>
      <input id="volumeSlider" type="range" min="0" max="100" value="70" />
      <span id="volumeLabel">70%</span>
    </div>
    <small>Tr√™n iOS / mobile, b·∫°n th∆∞·ªùng ph·∫£i b·∫•m 1 n√∫t m·ªõi nghe ƒë∆∞·ª£c √¢m thanh.</small>
  </div>

  <div class="panel">
    <div class="panel-title">üßç Player ‚Äì Gi·ªçng nam</div>
    <div class="btn-row">
      <button id="btnPlayerHit">ü©∏ Player b·ªã tr√∫ng ƒë·∫°n</button>
      <button id="btnStageClearVoice">üòÑ Th·∫Øng m√†n (c∆∞·ªùi)</button>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title">üëæ Enemy / Boss ‚Äì Gi·ªçng n·ªØ ki·ªÉu anime</div>
    <div class="btn-row">
      <button id="btnEnemyDie">üí• Qu√°i nh·ªè ch·∫øt</button>
      <button id="btnBossDie">üî• Boss ch·∫øt</button>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title">üíÄ Game Over ‚Äì Gi·ªçng n·ªØ tr√™u nh·∫π</div>
    <div class="btn-row">
      <button id="btnGameOverVoice">üòè Game Over (ch·∫ø nh·∫π)</button>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title">üí£ SFX th√™m (ƒë·ªÉ tham kh·∫£o)</div>
    <div class="btn-row">
      <button id="btnShot">üî´ Ti·∫øng s√∫ng</button>
      <button id="btnExplosion">üí£ Ti·∫øng n·ªï</button>
      <button id="btnHit">üí¢ Hit impact</button>
    </div>
    <small>ƒê√¢y l√† c√°c hi·ªáu ·ª©ng ƒë√£/ƒëang d√πng trong game ch√≠nh, ƒë·ªÉ b·∫°n so s√°nh.</small>
  </div>

  <div class="footer">
    Sau khi b·∫°n ∆∞ng √¢m thanh, m√¨nh s·∫Ω g·∫Øn c√πng 1 h·ªá th·ªëng Web Audio n√†y v√†o <b>index.html</b>,
    g·ªçi ƒë√∫ng effect ·ªü c√°c s·ª± ki·ªán: tr√∫ng ƒë·∫°n, qu√°i/boss ch·∫øt, th·∫Øng m√†n, thua game, v.v.
  </div>

<script>
  // ====== Web Audio setup ======
  let audioCtx = null;
  let masterGain = null;
  let audioEnabled = false;

  function initAudio() {
    if (audioCtx) {
      // Resume n·∫øu ƒëang suspended
      if (audioCtx.state === 'suspended') audioCtx.resume();
      audioEnabled = true;
      return;
    }
    try {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      masterGain = audioCtx.createGain();
      masterGain.gain.value = 0.7;
      masterGain.connect(audioCtx.destination);
      audioEnabled = true;
      console.log('[Audio] Initialized');
    } catch (e) {
      console.error('Audio init error:', e);
      audioEnabled = false;
      alert('Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ Web Audio ƒë·∫ßy ƒë·ªß.');
    }
  }

  function setMasterVolume(v) {
    if (!masterGain) return;
    masterGain.gain.value = v;
  }

  function stopAllAudio() {
    if (!audioCtx) return;
    audioCtx.close().then(() => {
      audioCtx = null;
      masterGain = null;
      audioEnabled = false;
      console.log('[Audio] Context closed');
    }).catch(e => {
      console.error(e);
    });
  }

  function playWithMaster(node, duration) {
    if (!audioEnabled || !audioCtx || !masterGain) return;
    node.connect(masterGain);
    node.start();
    if (duration) {
      node.stop(audioCtx.currentTime + duration + 0.05);
    }
  }

  // ====== Basic tone helpers (kh√¥ng b·∫£n quy·ªÅn) ======
  function playTone(freq, duration, opts = {}) {
    if (!audioEnabled || !audioCtx || !masterGain) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    const now = audioCtx.currentTime;
    const type = opts.type || 'sine';
    const vol  = opts.volume != null ? opts.volume : 0.4;

    osc.type = type;
    osc.frequency.setValueAtTime(freq, now);

    osc.connect(gain);
    gain.connect(masterGain);

    gain.gain.setValueAtTime(0.0001, now);
    gain.gain.linearRampToValueAtTime(vol, now + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);

    osc.start(now);
    osc.stop(now + duration + 0.05);
  }

  function playSweep(startFreq, endFreq, duration, opts = {}) {
    if (!audioEnabled || !audioCtx || !masterGain) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    const now = audioCtx.currentTime;

    const type = opts.type || 'sawtooth';
    const vol  = opts.volume != null ? opts.volume : 0.35;

    osc.type = type;
    osc.frequency.setValueAtTime(startFreq, now);
    osc.frequency.linearRampToValueAtTime(endFreq, now + duration);

    osc.connect(gain);
    gain.connect(masterGain);

    gain.gain.setValueAtTime(0.0001, now);
    gain.gain.linearRampToValueAtTime(vol, now + 0.02);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);

    osc.start(now);
    osc.stop(now + duration + 0.05);
  }

  function playNoise(duration, opts = {}) {
    if (!audioEnabled || !audioCtx || !masterGain) return;
    const bufferSize = audioCtx.sampleRate * duration;
    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
    }
    const src = audioCtx.createBufferSource();
    src.buffer = buffer;

    const gain = audioCtx.createGain();
    const now = audioCtx.currentTime;
    const vol = opts.volume != null ? opts.volume : 0.4;

    src.connect(gain);
    gain.connect(masterGain);

    gain.gain.setValueAtTime(vol, now);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);

    src.start(now);
    src.stop(now + duration + 0.05);
  }

  // ====== PLAYER: HIT (gi·ªçng nam ki·ªÉu "uugh") ======
  function sfxPlayerHit() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    const now = audioCtx.currentTime;

    // Ph·∫ßn 1: sweep xu·ªëng ‚Äì nghe nh∆∞ "uugh"
    playSweep(220, 120, 0.18, { type: 'triangle', volume: 0.45 });

    // Ph·∫ßn 2: 1 n·ªët tr·∫ßm ng·∫Øn ·ªü cu·ªëi
    setTimeout(() => {
      playTone(90, 0.08, { type: 'sine', volume: 0.35 });
    }, 130);
  }

  // ====== PLAYER: STAGE CLEAR (c∆∞·ªùi s·∫£ng kho√°i, synth) ======
  function sfxStageClearLaugh() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;

    const pattern = [
      { f: 380, d: 0.09 },
      { f: 520, d: 0.09 },
      { f: 660, d: 0.12 },
      { f: 580, d: 0.12 },
      { f: 720, d: 0.16 },
    ];

    let delay = 0;
    pattern.forEach((note) => {
      setTimeout(() => {
        playTone(note.f, note.d, { type: 'square', volume: 0.38 });
      }, delay);
      delay += note.d * 700;
    });
  }

  // ====== ENEMY DIE (N·ªØ anime nh·∫π: "h·ª±") ======
  function sfxEnemyDie() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;

    // Sweep l√™n nh·∫π, ng·∫Øn (cao ‚Üí anime n·ªØ), r·ªìi t·∫Øt nhanh
    playSweep(650, 900, 0.12, { type: 'sawtooth', volume: 0.35 });

    // Th√™m ch√∫t noise nh·ªè ƒë·ªÉ c√≥ c·∫£m gi√°c "v·ª°" khi ch·∫øt
    setTimeout(() => {
      playNoise(0.08, { volume: 0.22 });
    }, 40);
  }

  // ====== BOSS DIE (N·ªØ anime, k√™u "√°" d√†i h∆°n, drama) ======
  function sfxBossDie() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    const now = audioCtx.currentTime;

    // Ph·∫ßn 1: sweep l√™n (ti·∫øng "√°" b·∫Øt ƒë·∫ßu)
    playSweep(620, 980, 0.22, { type: 'triangle', volume: 0.4 });

    // Ph·∫ßn 2: rung nh·∫π + h·∫° t√¥ng, t·∫°o c·∫£m gi√°c "ng√¢n"
    setTimeout(() => {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sine';

      // vibrato
      osc.frequency.setValueAtTime(700, audioCtx.currentTime);
      osc.frequency.linearRampToValueAtTime(480, audioCtx.currentTime + 0.35);

      osc.connect(gain);
      gain.connect(masterGain);

      const g = gain.gain;
      const t0 = audioCtx.currentTime;
      g.setValueAtTime(0.0001, t0);
      g.linearRampToValueAtTime(0.32, t0 + 0.02);
      g.exponentialRampToValueAtTime(0.0001, t0 + 0.38);

      osc.start(t0);
      osc.stop(t0 + 0.42);
    }, 180);

    // M·ªôt ch√∫t noise cho hi·ªáu ·ª©ng ch·∫øt boss
    setTimeout(() => {
      playNoise(0.18, { volume: 0.26 });
    }, 130);
  }

  // ====== GAME OVER (N·ªØ c∆∞·ªùi tr√™u nh·∫π, kh√¥ng th√¥ t·ª•c) ======
  function sfxGameOverTease() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;

    // Chu·ªói "tee-hee" synth: cao, h∆°i l·∫£nh, ch∆°i 3 c·ª•m
    const laughs = [
      { freqs: [720, 840], dur: 0.07 },
      { freqs: [760, 880], dur: 0.08 },
      { freqs: [820, 900], dur: 0.09 },
    ];

    let baseDelay = 0;
    laughs.forEach(({ freqs, dur }) => {
      freqs.forEach((f, idx) => {
        setTimeout(() => {
          playTone(f, dur, { type: 'square', volume: 0.33 });
        }, baseDelay + idx * (dur * 600));
      });
      baseDelay += dur * 700 + 40;
    });

    // K·∫øt th√∫c b·∫±ng 1 n·ªët l∆∞·ª£n xu·ªëng (gi·ªëng ti·∫øng "hmmm~" tr√™u)
    setTimeout(() => {
      playSweep(600, 360, 0.22, { type: 'triangle', volume: 0.28 });
    }, baseDelay + 60);
  }

  // ====== SFX TH√äM: SHOT, EXPLOSION, HIT ======
  function sfxShot() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    playTone(900, 0.08, { type:'square', volume:0.35 });
  }

  function sfxHit() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    playTone(500, 0.06, { type:'sawtooth', volume:0.3 });
  }

  function sfxExplosion() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    playNoise(0.25, { volume: 0.4 });
    setTimeout(() => {
      playSweep(220, 80, 0.25, { type:'triangle', volume:0.3 });
    }, 10);
  }

  // ====== DOM HOOK ======
  const btnInitAudio    = document.getElementById('btnInitAudio');
  const btnStopAudio    = document.getElementById('btnStopAudio');
  const volumeSlider    = document.getElementById('volumeSlider');
  const volumeLabel     = document.getElementById('volumeLabel');

  const btnPlayerHit        = document.getElementById('btnPlayerHit');
  const btnStageClearVoice  = document.getElementById('btnStageClearVoice');
  const btnEnemyDie         = document.getElementById('btnEnemyDie');
  const btnBossDie          = document.getElementById('btnBossDie');
  const btnGameOverVoice    = document.getElementById('btnGameOverVoice');
  const btnShot             = document.getElementById('btnShot');
  const btnExplosion        = document.getElementById('btnExplosion');
  const btnHit              = document.getElementById('btnHit');

  btnInitAudio.addEventListener('click', () => {
    initAudio();
  });

  btnStopAudio.addEventListener('click', () => {
    stopAllAudio();
  });

  volumeSlider.addEventListener('input', () => {
    const v = parseInt(volumeSlider.value, 10) || 0;
    volumeLabel.textContent = v + '%';
    if (!audioEnabled || !audioCtx || !masterGain) return;
    setMasterVolume(v / 100);
  });

  btnPlayerHit.addEventListener('click', sfxPlayerHit);
  btnStageClearVoice.addEventListener('click', sfxStageClearLaugh);
  btnEnemyDie.addEventListener('click', sfxEnemyDie);
  btnBossDie.addEventListener('click', sfxBossDie);
  btnGameOverVoice.addEventListener('click', sfxGameOverTease);

  btnShot.addEventListener('click', sfxShot);
  btnExplosion.addEventListener('click', sfxExplosion);
  btnHit.addEventListener('click', sfxHit);
</script>
</body>
</html>
