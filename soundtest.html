<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Survival Shooter â€“ Sound Test</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    * { box-sizing:border-box; }
    body {
      margin:0;
      padding:16px;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #202642 0%, #050712 55%, #020308 100%);
      color:#fff;
      min-height:100vh;
      display:flex;
      flex-direction:column;
      align-items:center;
    }
    h1 {
      margin-top:8px;
      margin-bottom:4px;
      font-size:22px;
    }
    p {
      margin:0 0 12px;
      font-size:13px;
      opacity:0.9;
      text-align:center;
    }
    .panel {
      width:100%;
      max-width:420px;
      background:rgba(0,0,0,0.5);
      border-radius:16px;
      padding:12px;
      margin-top:10px;
      box-shadow:0 10px 30px rgba(0,0,0,0.6);
    }
    .panel-title {
      font-size:14px;
      font-weight:600;
      margin-bottom:8px;
      opacity:0.9;
    }
    .btn-row {
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin-bottom:8px;
    }
    button {
      border:none;
      border-radius:999px;
      padding:8px 12px;
      font-size:13px;
      cursor:pointer;
      background:#ffb100;
      color:#201317;
      font-weight:600;
      box-shadow:0 6px 16px rgba(0,0,0,0.5);
      display:inline-flex;
      align-items:center;
      gap:4px;
    }
    button.secondary {
      background:rgba(255,255,255,0.08);
      color:#fff;
      box-shadow:none;
    }
    button:active {
      transform:scale(0.96);
    }
    small {
      font-size:11px;
      opacity:0.75;
    }
    .footer {
      margin-top:18px;
      font-size:11px;
      opacity:0.7;
      text-align:center;
      max-width:420px;
    }
    .volume-row {
      display:flex;
      align-items:center;
      gap:8px;
      margin-top:4px;
    }
    input[type="range"] {
      flex:1;
    }
  </style>
</head>
<body>
  <h1>ğŸ”Š Survival Shooter â€“ Sound Test</h1>
  <p>
    Nháº¥n tá»«ng nÃºt Ä‘á»ƒ nghe thá»­ Ã¢m thanh sáº½ dÃ¹ng trong game.<br/>
    Táº¥t cáº£ Ä‘á»u lÃ  Ã¢m tá»•ng há»£p báº±ng Web Audio (khÃ´ng dÃ¹ng file giá»ng tháº­t, khÃ´ng báº£n quyá»n).
  </p>

  <div class="panel">
    <div class="panel-title">âš™ï¸ Audio Control</div>
    <div class="btn-row">
      <button id="btnInitAudio">Báº­t Audio (unmute)</button>
      <button id="btnStopAudio" class="secondary">Ngáº¯t má»i Ã¢m</button>
    </div>
    <div class="volume-row">
      <span>ğŸ”‰ Volume</span>
      <input id="volumeSlider" type="range" min="0" max="100" value="70" />
      <span id="volumeLabel">70%</span>
    </div>
    <small>TrÃªn iOS / mobile, báº¡n thÆ°á»ng pháº£i báº¥m 1 nÃºt má»›i nghe Ä‘Æ°á»£c Ã¢m thanh.</small>
  </div>

  <div class="panel">
    <div class="panel-title">ğŸ§ Player â€“ Giá»ng nam</div>
    <div class="btn-row">
      <button id="btnPlayerHit">ğŸ©¸ Player bá»‹ trÃºng Ä‘áº¡n</button>
      <button id="btnStageClearVoice">ğŸ˜„ Tháº¯ng mÃ n (cÆ°á»i)</button>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title">ğŸ‘¾ Enemy / Boss â€“ Giá»ng ná»¯ kiá»ƒu anime</div>
    <div class="btn-row">
      <button id="btnEnemyDie">ğŸ’¥ QuÃ¡i nhá» cháº¿t</button>
      <button id="btnBossDie">ğŸ”¥ Boss cháº¿t</button>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title">ğŸ’€ Game Over â€“ Giá»ng ná»¯ trÃªu cay hÆ¡n</div>
    <div class="btn-row">
      <button id="btnGameOverVoice">ğŸ˜ Game Over (cháº¿ máº¡nh)</button>
    </div>
  </div>

  <div class="panel">
    <div class="panel-title">ğŸ’£ SFX thÃªm (Ä‘á»ƒ tham kháº£o)</div>
    <div class="btn-row">
      <button id="btnShot">ğŸ”« Tiáº¿ng sÃºng (AK burst)</button>
      <button id="btnExplosion">ğŸ’£ Tiáº¿ng ná»•</button>
      <button id="btnHit">ğŸ’¢ Hit impact</button>
    </div>
    <small>ÄÃ¢y lÃ  cÃ¡c hiá»‡u á»©ng Ä‘Ã£/Ä‘ang dÃ¹ng trong game chÃ­nh, Ä‘á»ƒ báº¡n so sÃ¡nh.</small>
  </div>

  <div class="footer">
    Sau khi báº¡n Æ°ng Ã¢m thanh, mÃ¬nh sáº½ gáº¯n cÃ¹ng 1 há»‡ thá»‘ng Web Audio nÃ y vÃ o <b>index.html</b>,
    gá»i Ä‘Ãºng effect á»Ÿ cÃ¡c sá»± kiá»‡n: trÃºng Ä‘áº¡n, quÃ¡i/boss cháº¿t, tháº¯ng mÃ n, thua game, v.v.
  </div>

<script>
  // ====== Web Audio setup ======
  let audioCtx = null;
  let masterGain = null;
  let audioEnabled = false;

  function initAudio() {
    if (audioCtx) {
      if (audioCtx.state === 'suspended') audioCtx.resume();
      audioEnabled = true;
      return;
    }
    try {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      masterGain = audioCtx.createGain();
      masterGain.gain.value = 0.7;
      masterGain.connect(audioCtx.destination);
      audioEnabled = true;
      console.log('[Audio] Initialized');
    } catch (e) {
      console.error('Audio init error:', e);
      audioEnabled = false;
      alert('TrÃ¬nh duyá»‡t khÃ´ng há»— trá»£ Web Audio Ä‘áº§y Ä‘á»§.');
    }
  }

  function setMasterVolume(v) {
    if (!masterGain) return;
    masterGain.gain.value = v;
  }

  function stopAllAudio() {
    if (!audioCtx) return;
    audioCtx.close().then(() => {
      audioCtx = null;
      masterGain = null;
      audioEnabled = false;
      console.log('[Audio] Context closed');
    }).catch(e => {
      console.error(e);
    });
  }

  // ====== Basic helpers (tone + noise + sweep) ======
  function playNoise(duration, opts = {}) {
    if (!audioEnabled || !audioCtx || !masterGain) return;
    const bufferSize = audioCtx.sampleRate * duration;
    const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
    const data = buffer.getChannelData(0);
    for (let i = 0; i < bufferSize; i++) {
      data[i] = (Math.random() * 2 - 1) * (1 - i / bufferSize);
    }
    const src = audioCtx.createBufferSource();
    src.buffer = buffer;

    const gain = audioCtx.createGain();
    const now = audioCtx.currentTime;
    const vol = opts.volume != null ? opts.volume : 0.4;

    src.connect(gain);
    gain.connect(masterGain);

    gain.gain.setValueAtTime(vol, now);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);

    src.start(now);
    src.stop(now + duration + 0.05);
  }

  function playTone(freq, duration, opts = {}) {
    if (!audioEnabled || !audioCtx || !masterGain) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();

    const now = audioCtx.currentTime;
    const type = opts.type || 'sine';
    const vol  = opts.volume != null ? opts.volume : 0.4;

    osc.type = type;
    osc.frequency.setValueAtTime(freq, now);

    osc.connect(gain);
    gain.connect(masterGain);

    gain.gain.setValueAtTime(0.0001, now);
    gain.gain.linearRampToValueAtTime(vol, now + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);

    osc.start(now);
    osc.stop(now + duration + 0.05);
  }

  function playSweep(startFreq, endFreq, duration, opts = {}) {
    if (!audioEnabled || !audioCtx || !masterGain) return;
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    const now = audioCtx.currentTime;

    const type = opts.type || 'sawtooth';
    const vol  = opts.volume != null ? opts.volume : 0.35;

    osc.type = type;
    osc.frequency.setValueAtTime(startFreq, now);
    osc.frequency.linearRampToValueAtTime(endFreq, now + duration);

    osc.connect(gain);
    gain.connect(masterGain);

    gain.gain.setValueAtTime(0.0001, now);
    gain.gain.linearRampToValueAtTime(vol, now + 0.02);
    gain.gain.exponentialRampToValueAtTime(0.0001, now + duration);

    osc.start(now);
    osc.stop(now + duration + 0.05);
  }

  // ====== PLAYER: HIT (giá»ng nam kiá»ƒu "uugh") ======
  function sfxPlayerHit() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    playSweep(220, 120, 0.18, { type: 'triangle', volume: 0.45 });
    setTimeout(() => {
      playTone(90, 0.08, { type: 'sine', volume: 0.35 });
    }, 130);
  }

  // ====== PLAYER: STAGE CLEAR (cÆ°á»i sáº£ng khoÃ¡i synth) ======
  function sfxStageClearLaugh() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    const pattern = [
      { f: 380, d: 0.09 },
      { f: 520, d: 0.09 },
      { f: 660, d: 0.12 },
      { f: 580, d: 0.12 },
      { f: 720, d: 0.16 },
    ];
    let delay = 0;
    pattern.forEach((note) => {
      setTimeout(() => {
        playTone(note.f, note.d, { type: 'square', volume: 0.38 });
      }, delay);
      delay += note.d * 700;
    });
  }

  // ====== ENEMY DIE (Ná»¯ anime nháº¹: "há»±") ======
  function sfxEnemyDie() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    playSweep(650, 900, 0.12, { type: 'sawtooth', volume: 0.35 });
    setTimeout(() => {
      playNoise(0.08, { volume: 0.22 });
    }, 40);
  }

  // ====== BOSS DIE (Ná»¯ anime, kÃªu "Ã¡" dÃ i hÆ¡n, drama) ======
  function sfxBossDie() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;

    // "Ã" báº­t máº¡nh
    playSweep(620, 980, 0.22, { type: 'triangle', volume: 0.4 });

    // NgÃ¢n xuá»‘ng
    setTimeout(() => {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sine';

      osc.frequency.setValueAtTime(700, audioCtx.currentTime);
      osc.frequency.linearRampToValueAtTime(480, audioCtx.currentTime + 0.35);

      osc.connect(gain);
      gain.connect(masterGain);

      const g = gain.gain;
      const t0 = audioCtx.currentTime;
      g.setValueAtTime(0.0001, t0);
      g.linearRampToValueAtTime(0.32, t0 + 0.02);
      g.exponentialRampToValueAtTime(0.0001, t0 + 0.38);

      osc.start(t0);
      osc.stop(t0 + 0.42);
    }, 180);

    setTimeout(() => {
      playNoise(0.18, { volume: 0.26 });
    }, 130);
  }

  // ====== GAME OVER (Ná»¯ cÆ°á»i dáº¹o, cháº¿ máº¡nh hÆ¡n Ä‘á»ƒ "cay") ======
  function sfxGameOverTease() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;

    // 3 cá»¥m cÆ°á»i "hee-hee-hee" tÄƒng dáº§n Ä‘á»™ gáº¯t
    const groups = [
      { freqs: [760, 840, 880], gap: 55 },
      { freqs: [800, 880, 920], gap: 55 },
      { freqs: [840, 920, 960], gap: 55 },
    ];

    let baseDelay = 0;

    groups.forEach((g) => {
      g.freqs.forEach((f, idx) => {
        setTimeout(() => {
          // ná»‘t vuÃ´ng cao, láº£nh â€“ cáº£m giÃ¡c "hee~"
          playTone(f, 0.07, { type: 'square', volume: 0.34 });
        }, baseDelay + idx * g.gap);
      });

      // Cuá»‘i cá»¥m thÃªm 1 sweep ngáº¯n Ä‘i lÃªn (nháº¥n máº¡nh)
      setTimeout(() => {
        playSweep(
          g.freqs[g.freqs.length - 1],
          g.freqs[g.freqs.length - 1] + 140,
          0.09,
          { type: 'triangle', volume: 0.28 }
        );
      }, baseDelay + g.freqs.length * g.gap + 20);

      baseDelay += g.freqs.length * g.gap + 140;
    });

    // Káº¿t thÃºc báº±ng cÃº trÆ°á»£t dÃ i tá»« cao xuá»‘ng tháº¥p (kiá»ƒu "hÃ´ hÃ´ hÃ´~" rÆ¡i xuá»‘ng)
    setTimeout(() => {
      playSweep(780, 360, 0.42, {
        type: 'sawtooth',
        volume: 0.32
      });
    }, baseDelay + 80);

    // ThÃªm 1 cháº¥m noise cuá»‘i â€“ nhÆ° "táº¡t gÃ¡o nÆ°á»›c"
    setTimeout(() => {
      playNoise(0.12, { volume: 0.22 });
    }, baseDelay + 350);
  }

  // ====== SFX THÃŠM: SHOT (AK burst), EXPLOSION, HIT ======

  // Tiáº¿ng sÃºng AK-47 style: burst 4â€“5 viÃªn, má»—i viÃªn short noise + click cao
  function sfxShot() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;

    const shots = 5;          // sá»‘ viÃªn trong 1 burst
    const interval = 55;      // ms giá»¯a má»—i viÃªn

    for (let i = 0; i < shots; i++) {
      setTimeout(() => {
        // tiáº¿ng ná»• viÃªn Ä‘áº¡n (khÃ¡ khÃ´)
        playNoise(0.045, { volume: 0.45 });
        // click kim loáº¡i / ná»• vá» Ä‘áº¡n â€“ cao, cá»±c ngáº¯n
        playTone(1800, 0.03, { type: 'square', volume: 0.33 });
      }, i * interval);
    }
  }

  function sfxExplosion() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    playNoise(0.25, { volume: 0.4 });
    setTimeout(() => {
      playSweep(220, 80, 0.25, { type:'triangle', volume:0.3 });
    }, 10);
  }

  function sfxHit() {
    if (!audioEnabled) initAudio();
    if (!audioEnabled) return;
    playTone(500, 0.06, { type:'sawtooth', volume:0.3 });
  }

  // ====== DOM HOOK ======
  const btnInitAudio    = document.getElementById('btnInitAudio');
  const btnStopAudio    = document.getElementById('btnStopAudio');
  const volumeSlider    = document.getElementById('volumeSlider');
  const volumeLabel     = document.getElementById('volumeLabel');

  const btnPlayerHit        = document.getElementById('btnPlayerHit');
  const btnStageClearVoice  = document.getElementById('btnStageClearVoice');
  const btnEnemyDie         = document.getElementById('btnEnemyDie');
  const btnBossDie          = document.getElementById('btnBossDie');
  const btnGameOverVoice    = document.getElementById('btnGameOverVoice');
  const btnShot             = document.getElementById('btnShot');
  const btnExplosion        = document.getElementById('btnExplosion');
  const btnHit              = document.getElementById('btnHit');

  btnInitAudio.addEventListener('click', () => { initAudio(); });
  btnStopAudio.addEventListener('click', () => { stopAllAudio(); });

  volumeSlider.addEventListener('input', () => {
    const v = parseInt(volumeSlider.value, 10) || 0;
    volumeLabel.textContent = v + '%';
    if (!audioEnabled || !audioCtx || !masterGain) return;
    setMasterVolume(v / 100);
  });

  btnPlayerHit.addEventListener('click', sfxPlayerHit);
  btnStageClearVoice.addEventListener('click', sfxStageClearLaugh);
  btnEnemyDie.addEventListener('click', sfxEnemyDie);
  btnBossDie.addEventListener('click', sfxBossDie);
  btnGameOverVoice.addEventListener('click', sfxGameOverTease);

  btnShot.addEventListener('click', sfxShot);
  btnExplosion.addEventListener('click', sfxExplosion);
  btnHit.addEventListener('click', sfxHit);
</script>
</body>
</html>
